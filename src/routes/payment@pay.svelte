<script context="module">
	export async function load({ session }) {
		return {
			props: {
				email: session.email
			}
		};
	}
</script>

<script>
	import Checkout from '$lib/checkout/Checkout.svelte';
	import Shipping from '$lib/checkout/Shipping.svelte';
	import Summary from '$lib/checkout/Summary.svelte';
	import { onMount } from 'svelte';

	import { carts, deleteCart, fetchCarts } from '../store/cart';
	import { fetchProducts, products } from '../store/product';
	import { fetchUsers, getUserByEmail, users } from '../store/user';

	let isShow = false;

	export let email;

	let rows = [];
	let user = [];

	onMount(async () => await load());

	async function load() {
		await fetchCarts();
		await fetchProducts();
		user = await getUserByEmail(email);
		rows = $carts.rows.filter((item) => item.userId === user.id);
	}

	$: if (innerWidth > 1024) {
		isShow = false;
	}
	console.log(email);
	$: innerWidth = 0;
	$: console.log($products.rows,"------------", rows);
</script>

<svelte:window bind:innerWidth />
<h1 class="font-medium text-2xl my-5 lg:hidden block text-center ">Kotakoki</h1>
<button on:click={() => (isShow = !isShow)} class="bg-zinc-50  py-5 lg:hidden border-y">
	<div class="max-w-md mx-auto flex justify-between ">
		<p class="text-sm">
			<i class="fab fa-opencart mr-2 text-base" />
			Order Summary / coupon input
			<i class="fas fa-angle-down align-middle" />
		</p>
		<p class="font-medium text-lg">Â¥ 1,100</p>
	</div>
</button>
<Summary {isShow} res={true} {rows} products={$products?.rows} />
<div class="w-full bg-white pt-10 lg:pt-14 lg:pr-10 px-5">
	<div class="max-w-md mx-auto lg:max-w-lg lg:ml-auto lg:mx-0">
		<h1 class="font-medium text-2xl mb-4 lg:block hidden">Kotakoki</h1>
		<Checkout />
		<Shipping />
	</div>
</div>
